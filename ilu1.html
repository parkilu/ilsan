<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>열차번호 및 편성정보 조회</title>
  <style>
    /* 기본 스타일 */
    body {
      margin: 0;
      padding: 0;
      background: #f7f9fc;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
    }
    .container {
      position: relative;
      width: 90%;
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      padding: 25px 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    /* 제작자 정보 (우측 상단) */
    .footer {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 0.8rem;
      color: #777;
    }
    /* 제목 스타일 */
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
      color: #222;
    }
    h2 {
      font-size: 1.2rem;
      margin: 0;
      color: #222;
    }
    /* 날짜 선택 영역 */
    .date-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .date-input {
      flex: 1;
    }
    .date-input label, 
    .date-input input {
      display: block;
      width: 100%;
    }
    .date-input input {
      padding: 8px 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-top: 5px;
    }
    .date-info {
      flex: 1;
      color: #d9534f;
      font-size: 0.8rem;
      text-align: right;
      line-height: 1.4;
      padding-left: 10px;
    }
    /* 입력폼 영역 */
    .row {
      display: flex;
      align-items: stretch;
      gap: 15px;
      margin-bottom: 20px;
    }
    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .divider {
      width: 1px;
      background-color: #ccc;
      margin: 5px 0;
    }
    label {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #555;
    }
    input, select, button {
      padding: 8px 10px;
      font-size: 0.95rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #66afe9;
    }
    button {
      background: #007aff;
      color: #fff;
      cursor: pointer;
      border: none;
      transition: background 0.2s;
    }
    button:hover {
      background: #005bb5;
    }
    /* 결과 제목 영역 */
    .timetable-title, .traininfo-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .timetable-notice, .traininfo-notice {
      color: #d9534f;
      font-size: 0.8rem;
      text-align: right;
      line-height: 1.3;
    }
    /* 시간표 결과 영역 */
    .iframe-container-timetable {
      width: 100%;
      height: 400px;
      margin-bottom: 25px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      overflow-y: auto;
      position: relative;
    }
    .iframe-container-timetable iframe {
      width: 100%;
      height: 1200px; /* 고정된 내부 컨텐츠 높이 */
      border: none;
    }
    /* 편성정보 결과 영역 */
    .result-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .result-table td {
      padding: 0;
      border: 1px solid #e0e0e0;
    }
    .result-container {
      width: 100%;
      height: 300px;
      overflow: hidden;
      position: relative;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }
    .result-iframe {
      border: none;
      position: absolute;
      width: 1200px;
      height: 1200px;
      left: 0;
      top: 0;
    }
  </style>
  <script>
    // 노선별 역 목록 데이터
    const stationsData = {
      "Seoul_Line_3": [
        { name: "삼송", value: "7IK87Iah" },
        { name: "원흥", value: "7JuQ7Z2l" },
        { name: "원당", value: "7JuQ64u5" },
        { name: "화정", value: "7ZmU7KCV" },
        { name: "대곡(일)", value: "64yA6rOh" },
        { name: "백석", value: "67Cx7ISd" },
        { name: "마두", value: "66eI65GQ" },
        { name: "정발산", value: "7KCV67Cc7IKw" },
        { name: "주엽", value: "7KO87Je9" },
        { name: "대화", value: "64yA7ZmU" }
      ],
      "korail": [
        { name: "대곡(경)", value: "64yA6rOh" },
        { name: "대곡(서)", value: "64yA6rOh" },
        { name: "곡산", value: "6rOh7IKw" },
        { name: "백마", value: "67Cx66eI" },
        { name: "풍산", value: "7ZKN7IKw" },
        { name: "일산", value: "7J287IKw" },
        { name: "탄현", value: "7YOE7ZiE" },
        { name: "야당", value: "7JW864u5" },
        { name: "운정", value: "7Jq07KCV" },
        { name: "금릉", value: "6riI66aJ" },
        { name: "금촌", value: "6riI7LSM" },
        { name: "월롱", value: "7JuU66Gx" },
        { name: "파주", value: "7YyM7KO8" },
        { name: "문산", value: "66y47IKw" },
        { name: "운천", value: "7Jq07LKc" },
        { name: "임진강", value: "7J6E7KeE6rCV" }
      ]
    };

    function populateStations() {
      const lineSelect = document.getElementById('line');
      const stationSelect = document.getElementById('station');
      const selectedLine = lineSelect.value;
      const stations = stationsData[selectedLine] || [];
      stationSelect.innerHTML = "";
      stations.forEach((station, idx) => {
        const opt = document.createElement('option');
        opt.value = station.value + "|" + selectedLine;
        opt.textContent = station.name;
        if(idx === 0) opt.selected = true;
        stationSelect.appendChild(opt);
      });
    }

    function loadTimetable() {
      const dateInput = document.getElementById('date').value;
      const stationValue = document.getElementById('station').value;
      if (!dateInput || !stationValue) {
        alert("날짜와 역 정보를 선택해주세요.");
        return;
      }
      const [q, c] = stationValue.split('|');
      const dateStr = dateInput.replace(/-/g, '');
      const url = `https://rail.blue/railroad/logis/metrotimetable.aspx?q=${q}&c=${c}&date=${dateStr}&skip=1&hz=0&sec=0&option=448&base=1#!`;
      document.getElementById('timetableFrame').src = url;
    }

    function scrollTimetableTo30Percent() {
      const container = document.getElementById('iframeContainerTimetable');
      container.scrollTop = (container.scrollHeight - container.clientHeight) * 0.3;
    }

    function loadTrainInfo() {
      const date = document.getElementById("date").value;
      const company = document.getElementById("company").value;
      const trainNum = document.getElementById("trainNumber").value.trim();
      if (!date || !trainNum) {
        alert("날짜와 열차번호를 입력해주세요.");
        return;
      }
      if (!/^\d{4}$/.test(trainNum)) {
        alert("열차번호는 4자리 숫자여야 합니다.");
        return;
      }
      var trainNumberParam = (company === "S") ? trainNum : (company + trainNum);
      var url = "https://tabriz.kr/tripinfo/?company=" + company +
                "&date=" + date +
                "&trainNumber=" + trainNumberParam;
      var resultIframe = document.getElementById("resultIframe");
      resultIframe.src = url;
      var iframeHeight = 1200;
      var verticalOffset = iframeHeight * 0.27;
      resultIframe.style.top = "-" + verticalOffset + "px";
      resultIframe.style.left = "0px";
      
      // 편성정보 결과 영역으로 부드럽게 스크롤 이동
      document.getElementById('resultContainer').scrollIntoView({ behavior: 'smooth' });
      
      // 편성정보 결과 제목 오른쪽의 "로딩중" 문구를 5초 후 제거
      const traininfoNotice = document.getElementById("traininfoNotice");
      traininfoNotice.textContent = "로딩중";
      setTimeout(() => {
        traininfoNotice.textContent = "";
      }, 5000);
    }

    window.onload = function() {
      populateStations();
      loadTimetable();
      document.getElementById("timetableFrame").addEventListener("load", scrollTimetableTo30Percent);
      document.getElementById("trainNumber").addEventListener("keydown", function(e) {
        if (e.key === "Enter") {
          e.preventDefault();
          loadTrainInfo();
        }
      });
    };
  </script>
</head>
<body>
  <div class="container">
    <div class="footer">일산건축사업소 박일우</div>
    <h1>열차번호 및 편성정보 조회</h1>
    <!-- 날짜 선택 영역 -->
    <div class="date-row">
      <div class="date-input">
        <label for="date">날짜:</label>
        <input type="date" id="date" value="2025-02-24" required>
      </div>
      <div class="date-info">
        날짜를 선택하세요<br>
        편성번호는 특정 열차의 고유 번호<br>
        열차번호는 매일 변경
      </div>
    </div>
    <!-- 입력폼 영역 -->
    <div class="row">
      <div class="column">
        <label for="line">노선 선택:</label>
        <select id="line" onchange="populateStations()">
          <option value="Seoul_Line_3">일산선</option>
          <option value="korail">경의선</option>
        </select>
        <label for="station">역명 선택:</label>
        <select id="station">
          <!-- populateStations()에서 채워짐 -->
        </select>
        <button type="button" onclick="loadTimetable()">시간표 조회</button>
      </div>
      <div class="divider"></div>
      <div class="column">
        <label for="company">회사 코드:</label>
        <select id="company" required>
          <option value="S">S</option>
          <option value="K">K</option>
        </select>
        <label for="trainNumber">열차번호 (4자리):</label>
        <input type="text" id="trainNumber" pattern="\d{4}" maxlength="4" placeholder="예: 3393" required>
        <button type="button" onclick="loadTrainInfo()">편성정보 조회</button>
      </div>
    </div>
    <!-- 시간표 결과 제목 및 안내 문구 -->
    <div class="timetable-title">
      <h2>시간표 결과</h2>
      <div class="timetable-notice">
        열차번호 클릭하여 지연시간 확인<br>
        지연시간 추가하여 로그시간과 비교
      </div>
    </div>
    <div class="iframe-container-timetable" id="iframeContainerTimetable">
      <iframe id="timetableFrame"></iframe>
    </div>
    <!-- 편성정보 결과 제목 및 안내 문구 -->
    <div class="traininfo-title">
      <h2>편성정보 결과</h2>
      <div class="traininfo-notice" id="traininfoNotice"></div>
    </div>
    <table class="result-table">
      <tr>
        <td>
          <div class="result-container" id="resultContainer">
            <iframe id="resultIframe" class="result-iframe"></iframe>
          </div>
        </td>
      </tr>
    </table>
  </div>
</body>
</html>
